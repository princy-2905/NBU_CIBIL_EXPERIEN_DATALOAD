Drop table nbu.finbox_sms_data;
create table nbu.finbox_sms_data as 
SELECT 
CAST(customer_id as varchar(50)),
CAST(request_id as varchar(50)),
GETDATE() as created_at,
GETDATE() as updated_at,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 0) , 'value') as varchar(50)) as insurance_flag,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 1) , 'value') as varchar(50)) as cnt_insurance_accounts,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 2) , 'value') as varchar(MAX)) as amt_insurance_accounts_c180,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 3) , 'value') as  varchar(MAX)) as amt_insurance_accounts_last_6mo,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 4) , 'value') as varchar(50)) as insurance_trx_recency,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 5) , 'value') as varchar(50)) as  mf_flag,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 6) , 'value') as  varchar(MAX)) as amt_mf_portfolio,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 7) , 'value') as varchar(50)) as mf_trx_recency,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 8) , 'value') as varchar(MAX)) as amt_mf_accounts_c90,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 9) , 'value') as  varchar(MAX)) as amt_mf_accounts_c180,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 10) , 'value') as varchar(50)) as investor_flag,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 11) , 'value') as varchar(50)) as equity_flag,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 12) , 'value') as varchar(50)) as investor1_name,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 13) , 'value') as varchar(50)) as investor2_name,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 14) , 'value') as  varchar(MAX)) as total_amt_equity_portfolio_latest,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 15) , 'value') as varchar(50)) as cnt_equity_trx_last_6mo,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 16) , 'value') as  varchar(MAX)) as max_amt_equity_portfolio,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 17) , 'value') as  varchar(MAX)) as total_amt_ledger_last_6mo,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 18) , 'value') as  varchar(MAX)) as amt_fd_accounts_c180,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 19) , 'value') as varchar(50)) as cnt_fd_accounts,
JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 20) , 'value')  as mf_trx_latest_date,
JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 21) , 'value')  as loan_disbursed_latest_date,
JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 22) , 'value')  as insurance_trx_latest_date,
JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 23) , 'value')  as trade_trx_latest_date,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 24) , 'value') as varchar(50)) as credit_card_user_flag,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 25) , 'value') as  varchar(MAX)) as max_cc_limit,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 26) , 'value') as varchar(50)) as cnt_cc_acc,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 27) , 'value') as  varchar(MAX)) as max_preapproved_cc_limit,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 28) , 'value') as  varchar(MAX)) as cc_bill_m0,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 29) , 'value') as  varchar(MAX)) as cc_bill_m1,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 30) , 'value') as  varchar(MAX)) as max_cc_bill_m0,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 31) , 'value') as  varchar(MAX)) as max_cc_bill_m1,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 32) , 'value') as varchar(50)) as cc1_bank,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 33) , 'value') as varchar(50)) as cnt_cc_applications_c90,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 34) , 'value') as  varchar(MAX)) as cc_utilisation,
JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 35) , 'value') as cc_latest_bill_date,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 36) , 'value') as varchar(50)) as cnt_loan_accounts,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 37) , 'value') as varchar(50)) as cnt_personal_loan,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 38) , 'value') as varchar(50)) as cnt_apps_sub_genre_lending_v2,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 39) , 'value') as varchar(50)) as cnt_active_loan_accounts_m1,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 40) , 'value') as  varchar(MAX)) as max_disbursed_amt_active_loan_accounts,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 41) , 'value')  as varchar(50)) as cnt_closed_loan_accounts,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 42) , 'value') as  varchar(MAX)) as max_disbursed_amt_closed_loan_accounts,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 43) , 'value')  as varchar(50)) as cnt_loan_disbursed_gt_100k,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 44) , 'value')  as varchar(50)) as cnt_active_loan_disbursed_gt_100k,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 45) , 'value')  as varchar(50)) as max_dpd_all_acc,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 46) , 'value') as  varchar(MAX)) as max_amt_delinquncy_c180,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 47) , 'value') as varchar(50)) as cnt_loan_disbursed_last_6mo,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 48) , 'value') as varchar(50)) as cnt_loan_rejected_c90,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 49) , 'value') as varchar(50)) as cnt_loan_applications_c90,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 50) , 'value') as  varchar(MAX)) as total_emi_loan_all_acc_m0,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 51) , 'value') as  varchar(MAX)) as total_emi_loan_all_acc_m1,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 52) , 'value') as  varchar(MAX)) as max_emi_loan_all_acc_m0,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 53) , 'value') as  varchar(MAX)) as max_emi_loan_all_acc_m1,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 54) , 'value') as  varchar(MAX)) as avg_emi_loan_all_acc_m0,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 55) , 'value') as  varchar(MAX)) as avg_emi_loan_all_acc_m1,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 56) , 'value') as  varchar(MAX)) as total_emi_loan_all_acc_c90,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 57) , 'value') as  varchar(MAX)) as max_emi_loan_all_acc_c90,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 58) , 'value') as  varchar(MAX)) as max_preapproved_bnpl_limit_c90,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 59) , 'value') as  varchar(MAX)) as  max_bal_m0,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 60) , 'value') as  varchar(MAX)) as max_bal_m1,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 61) , 'value')  as  varchar(MAX)) as avg_bal_m0,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 62) , 'value') as  varchar(MAX)) as avg_bal_m1,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 63) , 'value') as  varchar(MAX)) as max_amt_credit_txn_last_3mo,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 64) , 'value') as  varchar(MAX)) as max_amt_credit_txn_last_6mo,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 65) , 'value') as  varchar(MAX)) as max_amt_debit_txn_last_3mo,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 66) , 'value') as  varchar(MAX)) as max_amt_debit_txn_last_6mo,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 67) , 'value') as  varchar(MAX)) as amt_credit_txn_last_6mo,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 68) , 'value') as  varchar(MAX)) as amt_debit_txn_last_6mo,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 69) , 'value')  as  varchar(MAX)) as cnt_credit_100k_last_6mo,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 70) , 'value') as  varchar(MAX)) as cnt_debit_100k_last_6mo,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 71) , 'value') as  varchar(MAX)) as sum_acc_latest_balance_c30,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 72) , 'value')  as  varchar(MAX)) as min_bal_c30,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 73) , 'value') as  varchar(MAX)) as max_bal_c30,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 74) , 'value') as  varchar(MAX)) as avg_bal_c30,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 75) , 'value') as  varchar(50)) as cnt_credit_txn_c30,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 76) , 'value') as  varchar(50)) as cnt_debit_txn_c30,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 77) , 'value') as  varchar(50)) as cnt_credit_txn_c90,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 78) , 'value') as  varchar(50)) as cnt_debit_txn_c90,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 79) , 'value') as  varchar(50)) as cnt_credit_txn_c180,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 80) , 'value') as  varchar(50)) as cnt_debit_txn_c180,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 81) , 'value') as  varchar(50)) as cnt_savings_accounts,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 82) , 'value') as  varchar(MAX)) as  obligations,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 83) , 'value') as  varchar(MAX)) as avg_total_income_c90,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 84) , 'value') as  char(10)) as calculated_income_amount_confidence_v3,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 85) , 'value') as varchar(MAX))  as calculated_income_amount_v3,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 86) , 'value') as varchar(50)) as salaried_flag_v3,
JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 87) , 'value') as salary_date_m0_v3,
JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 88) , 'value')  as salary_date_m1_v3,
JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 89) , 'value') as salary_date_m2_v3,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 90) , 'value') as varchar(50)) as fd_flag,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 91) , 'value') as varchar(50)) as rd_flag,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 92) , 'value') as varchar(50)) as po_flag,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 93) , 'value') as  varchar(50)) as all_sms_count,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 94) , 'value') as  varchar(50)) as sms_vintage,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 95) , 'value') as  varchar(50)) as sms_recency,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 96) , 'value') as  varchar(50)) as transactional_sms_count,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 97) , 'value') as  varchar(50)) as cnt_apps_fake_gps_c30,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 98) , 'value') as  varchar(50)) as concentration_device,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 99) , 'value') as  varchar(50)) as concentration_location,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 100) , 'value') as  varchar(50)) as concentration_ip_address,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 101) , 'value') as  varchar(50)) as cnt_ewallets_used,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 102) , 'value') as  varchar(50)) as cnt_apps_root_c30,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 103) , 'value') as  varchar(50)) as all_connected_devices,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 104) , 'value') as  varchar(50)) as cnt_fraud_assists_apps,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 105) , 'value') as  varchar(50)) as fraud_flag,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 106) , 'value') as  varchar(50)) as bounce_flag,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 107) , 'value') as  varchar(50)) as auto_debit_bounce_m0,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 108) , 'value') as  varchar(50)) as auto_debit_bounce_m1,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 109) , 'value') as  varchar(50)) as cheque_bounce_c30,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 110) , 'value') as  varchar(50)) as cnt_overdue_sms_c90,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 111) , 'value') as  varchar(50)) as cnt_loan_writtenoff_c180,
CAST(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_ARRAY_ELEMENT_TEXT(data, 112) , 'value') as  varchar(50)) as data_sufficiency_flag
from nbu.stg_finbox_sms_data;