Drop table nbu.cibil_account_segment;
Create table nbu.cibil_account_segment (
 id int,
 response_id varchar(32),   
member_reference varchar(MAX),
acct_number varchar(MAX),
membershortname varchar(MAX),
enr_enq_pa varchar(MAX),
reportingmembershortname varchar(MAX),
accountnumber varchar(MAX),
accounttype varchar(MAX),
ownershipindicator varchar(MAX),
dateopeneddisbursed varchar(MAX),
dateoflastpayment varchar(MAX),
dateclosed varchar(MAX),
datereported_trades varchar(MAX),
highcreditsanctionedamount varchar(MAX),
currentbalance varchar(MAX),
amountoverdue varchar(MAX),
paymt_hst_01 varchar(MAX),
paymt_hst_02 varchar(MAX),
paymt_hst_03 varchar(MAX),
paymt_hst_04 varchar(MAX),
paymt_hst_05 varchar(MAX),
paymt_hst_06 varchar(MAX),
paymt_hst_07 varchar(MAX),
paymt_hst_08 varchar(MAX),
paymt_hst_09 varchar(MAX),
paymt_hst_10 varchar(MAX),
paymt_hst_11 varchar(MAX),
paymt_hst_12 varchar(MAX),
paymt_hst_13 varchar(MAX),
paymt_hst_14 varchar(MAX),
paymt_hst_15 varchar(MAX),
paymt_hst_16 varchar(MAX),
paymt_hst_17 varchar(MAX),
paymt_hst_18 varchar(MAX),
paymt_hst_19 varchar(MAX),
paymt_hst_20 varchar(MAX),
paymt_hst_21 varchar(MAX),
paymt_hst_22 varchar(MAX),
paymt_hst_23 varchar(MAX),
paymt_hst_24 varchar(MAX),
paymt_hst_25 varchar(MAX),
paymt_hst_26 varchar(MAX),
paymt_hst_27 varchar(MAX),
paymt_hst_28 varchar(MAX),
paymt_hst_29 varchar(MAX),
paymt_hst_30 varchar(MAX),
paymt_hst_31 varchar(MAX),
paymt_hst_32 varchar(MAX),
paymt_hst_33 varchar(MAX),
paymt_hst_34 varchar(MAX),
paymt_hst_35 varchar(MAX),
paymt_hst_36 varchar(MAX),
pay_hist_start_date varchar(MAX),
pay_hist_end_date varchar(MAX),
suit_filed_status varchar(MAX),
credit_facility_status varchar(MAX),
collateral_type varchar(MAX),
collateral_value varchar(MAX),
credit_limit varchar(MAX),
cash_limit varchar(MAX),
roi varchar(MAX),
tenure varchar(MAX),
emi_amt varchar(MAX),
writeoff_amt_tot varchar(MAX),
writeoff_amt_prin varchar(MAX),
settlement_amt varchar(MAX),
paymt_freq varchar(MAX),
actual_paymt_amt varchar(MAX),
dateofentry_errorcode_tl varchar(MAX),
errorcode_tl varchar(MAX),
date_cibilremarkscode_tl varchar(MAX),
cibilremarkscode_tl varchar(MAX),
disputeremarkscode_tl varchar(MAX),
disputeremarkscode1_tl varchar(MAX),
disputeremarkscode2_tl varchar(MAX),
created_at varchar(MAX),
updated_at varchar(MAX)
) DISTSTYLE AUTO;




insert into nbu.cibil_account_segment
select 
ROW_NUMBER() over(order by response_id),
response_id,
cast ( memberreference as varchar(MAX)),
cast(acct_number as varchar(max) ) ,
cast(membershortname as varchar(max) ) ,
cast(enr_enq_pa as varchar(5) ) ,
cast(reportingmembershortname as varchar(max) ) ,
cast(accountnumber as varchar(max) ) ,
cast(accounttype as varchar(max) ) ,
cast(ownershipindicator as varchar(MAX) ) ,
to_date(LPAD(TRIM(BOTH ' ' FROM dateopeneddisbursed), 8, '0') , 'DDMMYYYY') as dateopeneddisbursed ,
to_date(LPAD(TRIM(BOTH ' ' FROM dateoflastpayment), 8, '0') , 'DDMMYYYY') as dateoflastpayment ,
to_date(LPAD(TRIM(BOTH ' ' FROM dateclosed), 8, '0') , 'DDMMYYYY') as dateclosed ,
to_date(LPAD(TRIM(BOTH ' ' FROM datereported_trades), 8, '0') , 'DDMMYYYY') as datereported_trades ,
cast(highcreditsanctionedamount as varchar(MAX) ) ,
cast(currentbalance as varchar(MAX) ) ,
cast(amountoverdue as varchar(MAX) ) ,
cast(paymt_hst_01 as varchar(10) ) ,
cast(paymt_hst_02 as varchar(10) ) ,
cast(paymt_hst_03 as varchar(10) ) ,
cast(paymt_hst_04 as varchar(10) ) ,
cast(paymt_hst_05 as varchar(10) ) ,
cast(paymt_hst_06 as varchar(10) ) ,
cast(paymt_hst_07 as varchar(10) ) ,
cast(paymt_hst_08 as varchar(10) ) ,
cast(paymt_hst_09 as varchar(10) ) ,
cast(paymt_hst_10 as varchar(10) ) ,
cast(paymt_hst_11 as varchar(10) ) ,
cast(paymt_hst_12 as varchar(10) ) ,
cast(paymt_hst_13 as varchar(10) ) ,
cast(paymt_hst_14 as varchar(10) ) ,
cast(paymt_hst_15 as varchar(10) ) ,
cast(paymt_hst_16 as varchar(10) ) ,
cast(paymt_hst_17 as varchar(10) ) ,
cast(paymt_hst_18 as varchar(10) ) ,
cast(paymt_hst_19 as varchar(10) ) ,
cast(paymt_hst_20 as varchar(10) ) ,
cast(paymt_hst_21 as varchar(10) ) ,
cast(paymt_hst_22 as varchar(10) ) ,
cast(paymt_hst_23 as varchar(10) ) ,
cast(paymt_hst_24 as varchar(10) ) ,
cast(paymt_hst_25 as varchar(10) ) ,
cast(paymt_hst_26 as varchar(10) ) ,
cast(paymt_hst_27 as varchar(10) ) ,
cast(paymt_hst_28 as varchar(10) ) ,
cast(paymt_hst_29 as varchar(10) ) ,
cast(paymt_hst_30 as varchar(10) ) ,
cast(paymt_hst_31 as varchar(10) ) ,
cast(paymt_hst_32 as varchar(10) ) ,
cast(paymt_hst_33 as varchar(10) ) ,
cast(paymt_hst_34 as varchar(10) ) ,
cast(paymt_hst_35 as varchar(10) ) ,
cast(paymt_hst_36 as varchar(10) ) ,
to_date(LPAD(TRIM(BOTH ' ' FROM pay_hist_start_date), 8, '0') , 'DDMMYYYY') as pay_hist_start_date ,
to_date(LPAD(TRIM(BOTH ' ' FROM pay_hist_end_date), 8, '0') , 'DDMMYYYY') as pay_hist_end_date ,
cast(suit_filed_status as varchar(10) ) ,
cast(credit_facility_status as varchar(10) ) ,
cast(collateral_type as varchar(MAX) ) ,
cast(collateral_value as varchar(MAX) ) ,
cast(credit_limit as varchar(MAX) ) ,
cast(cash_limit as varchar(MAX) ) ,
cast(roi as decimal(10,5) ) ,
cast(tenure as varchar(MAX) ) ,
cast(emi_amt as varchar(MAX) ) ,
cast(writeoff_amt_tot as varchar(MAX) ) ,
cast(writeoff_amt_prin as varchar(MAX) ) ,
cast(settlement_amt as varchar(MAX) ) ,
cast(paymt_freq as varchar(MAX) ) ,
cast(actual_paymt_amt as varchar(MAX) )  ,
cast(dateofentry_errorcode_tl as varchar(MAX) ) ,
cast(errorcode_tl as varchar(MAX) ) ,
cast(date_cibilremarkscode_tl as varchar(MAX) ) ,
cast(cibilremarkscode_tl as varchar(MAX) ) ,
cast(disputeremarkscode_tl as varchar(MAX) ) ,
cast(disputeremarkscode1_tl as varchar(MAX) ) ,
cast(disputeremarkscode2_tl as varchar(MAX) ) ,
getdate(),
getdate()
from "digital-revenue"."nbu"."stg_cibil_data"
where accounttype is not null


--select * from nbu.cibil_account_segment


